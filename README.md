# Docker Image Optimization and Size Reduction: Tips & Tricks

## ğŸ‘¨â€ğŸ’»Team

|<img src="https://avatars.githubusercontent.com/u/139302518?v=4" width="100" height="100"/>|<img src="https://avatars.githubusercontent.com/u/78792358?v=4" width="100" height="100"/>|
|:-:|:-:|
|ê³½ë³‘ì°¬<br/>[@gato-46](https://github.com/gato-46)|ë°•í˜„ìš°<br/>[@smartcow99](https://github.com/smartcow99)|

## ê°œìš”

Dockerë¥¼ ì‚¬ìš©í•˜ëŠ” ê°€ì¥ **í° ì´ìœ **ëŠ” ê°€ìƒë¨¸ì‹ ì— ë¹„í•´ì„œ **ì‘ì€ í¬ê¸°ë¥¼ ê°€ì§€ëŠ” ê²ƒ**ì´ë¼ ìƒê°í•©ë‹ˆë‹¤.

ì´ì—, Docker ì´ë¯¸ì§€ë¥¼ **ìµœì í™”í•˜ê³  í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ê²ƒ**ì´ êµ‰ì¥íˆ ì¤‘ìš”í•˜ë‹¤ëŠ” ìƒê°ì´ ë“¤ì–´ í•™ìŠµì„ ì‹œì‘í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

## ëª©í‘œğŸ

ì´ ë¬¸ì„œì˜ ëª©í‘œëŠ” *Docker ì´ë¯¸ì§€ë¥¼ ìµœì í™”í•˜ê³  í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ë‹¤ì–‘í•œ ê¸°ë²•*ì„ ë°°ìš°ëŠ” ê²ƒì…ë‹ˆë‹¤.  
ì´ëŸ¬í•œ ìµœì í™” ê¸°ë²•ì„ í†µí•´ ë¦¬ì†ŒìŠ¤ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©í•˜ê³  ë°°í¬ ì†ë„ë¥¼ í–¥ìƒì‹œí‚¤ë©° ë³´ì•ˆì„ ê°•í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ì´ë¥¼ í†µí•´ ë” ë‚˜ì€ ê°œë°œ í™˜ê²½ì„ ë§Œë“¤ê³  ì„œë¹„ìŠ¤ ì œê³µ ì‹œ ë¹„ìš©ì„ ì ˆê°í•˜ëŠ” ë° ê¸°ì—¬í•  ìˆ˜ ìˆëŠ”ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

## 

Docker ì´ë¯¸ì§€ë¥¼ ìµœì í™”í•˜ê³  í¬ê¸°ë¥¼ ì¤„ì´ê¸° ìœ„í•´ ì—¬ëŸ¬ ê¸°ë²•ê³¼ ëª¨ë²” ì‚¬ë¡€ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ì´ë¯¸ì§€ ìµœì í™” ë° í¬ê¸° ì¶•ì†Œë¥¼ ìœ„í•œ ì£¼ìš” ì „ëµë“¤ì…ë‹ˆë‹¤.

### 1. Use Minimal Base Images

Docker ì´ë¯¸ì§€ë¥¼ ì‘ì„±í•  ë•Œ ìµœì†Œí•œì˜ ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë² ì´ìŠ¤ ì´ë¯¸ì§€ì¸ UbuntuëŠ” ì•½ 128MBì´ì§€ë§Œ, **Alpine Linux**ë¥¼ ì‚¬ìš©í•˜ë©´ ì•½ 5MBë¡œ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë” ë‚˜ì•„ê°€ **Distroless** ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Distroless ì´ë¯¸ì§€ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ê·¸ ëŸ°íƒ€ì„ ì¢…ì†ì„±ë§Œ í¬í•¨ë˜ë©°, ë¶ˆí•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ í¬í•¨í•˜ì§€ ì•Šì•„ ë³´ì•ˆì„±ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì•Œë ¤ì§„ ì·¨ì•½ì (CVEs)ì˜ ìˆ˜ë¥¼ ì¤„ì´ëŠ” ë° ê¸°ì—¬í•©ë‹ˆë‹¤.

| TAG | SIZE |
| --- | --- |
| debian | 124.0MB |
| alpine | 5.0MB |
| gcr.io/distroless/static-debian11 | 2.51MB |

ì˜ˆì‹œ:

```bash
gcr.io/distroless/static-debian11    2.51MB

```

### 2. Minimize Layers

Dockerfileì—ì„œ ë ˆì´ì–´ ìˆ˜ë¥¼ ì¤„ì´ëŠ” ê²ƒì€ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ë˜ ë‹¤ë¥¸ ì¤‘ìš”í•œ ë°©ë²•ì…ë‹ˆë‹¤. DockerëŠ” ê° ëª…ë ¹ì–´ë§ˆë‹¤ ìƒˆë¡œìš´ ë ˆì´ì–´ë¥¼ ìƒì„±í•˜ë¯€ë¡œ, ì—¬ëŸ¬ `RUN` ëª…ë ¹ì–´ë¥¼ í•˜ë‚˜ì˜ ëª…ë ¹ì–´ë¡œ ê²°í•©í•˜ì—¬ ë ˆì´ì–´ ìˆ˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Before:**

```bash
FROM golang:1.18 as build
RUN go mod download
RUN go mod verify
```

**After:**

```bash
FROM golang:1.18
RUN go mod download && go mod verify
```

ì´ë ‡ê²Œ í•˜ë©´ ë ˆì´ì–´ ìˆ˜ê°€ ì¤„ì–´ë“¤ì–´ ì´ë¯¸ì§€ í¬ê¸°ë„ ê°ì†Œí•©ë‹ˆë‹¤.

### 3. Multi-Stage Builds

ë‹¤ë‹¨ê³„ ë¹Œë“œë¥¼ í™œìš©í•˜ë©´ ë¹Œë“œ í™˜ê²½ê³¼ ìµœì¢… ì´ë¯¸ì§€ë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë‹¨ê³„ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•˜ê³ , ë‘ ë²ˆì§¸ ë‹¨ê³„ì—ì„œ í•„ìš”í•œ ì•„í‹°íŒ©íŠ¸ë§Œ ë³µì‚¬í•˜ì—¬ ìµœì¢… ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ìµœì¢… ì´ë¯¸ì§€ì—ëŠ” ë¶ˆí•„ìš”í•œ íŒŒì¼ì´ í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```
# Start by building the application.
FROM golang:1.20-alpine AS build

WORKDIR /build
COPY go.mod go.sum ./
RUN go mod download && go mod verify
COPY . .

RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o run .

# Now copy it into our distroless image.
FROM gcr.io/distroless/static-debian11
WORKDIR /app
COPY --from=build /build/run .
CMD ["/app/run"]
```

### 4. Use .dockerignore

`.dockerignore` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ Docker ì´ë¯¸ì§€ ë¹Œë“œ ì‹œ ë¶ˆí•„ìš”í•œ íŒŒì¼ê³¼ ë””ë ‰í„°ë¦¬ë¥¼ ì œì™¸í•©ë‹ˆë‹¤. ì´ íŒŒì¼ì€ `git` ì €ì¥ì†Œì˜ íŒŒì¼, ê°œë°œ ë„êµ¬ ë° ê¸°íƒ€ ì„ì‹œ íŒŒì¼ì„ í¬í•¨í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ìµœì†Œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
node_modules
Dockerfile*
.git
.github
.gitignore
dist/**
README.md
```

### 5. Leverage Compression Tools

Docker Slimê³¼ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ Docker ì´ë¯¸ì§€ë¥¼ ì••ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë„êµ¬ëŠ” ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ê³  í•„ìš” ì—†ëŠ” íŒŒì¼ê³¼ ì¢…ì†ì„±ì„ ì œê±°í•˜ì—¬ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì¤„ì…ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì–´ë¡œ Docker Slimì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
docker-slim build --sensor-ipc-mode proxy --sensor-ipc-endpoint 172.17.0.1 --http-probe=false nginx
```

### 6. Security Scanning

Docker ì´ë¯¸ì§€ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ë³´ì•ˆ ìŠ¤ìº”ì„ í†µí•´ ì·¨ì•½ì ì„ ì ê²€í•´ì•¼ í•©ë‹ˆë‹¤. ì—¬ëŸ¬ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ë‚´ ë³´ì•ˆ ì·¨ì•½ì ì„ ì‹ë³„í•˜ê³ , ì •ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ì™€ íŒ¨ì¹˜ë¥¼ ì ìš©í•˜ì—¬ ë³´ì•ˆì„ ê°•í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³´ì•ˆì„±ì„ ë†’ì´ëŠ” ê²ƒì€ ì¥ê¸°ì ì¸ ì•ˆì •ì„±ì„ í™•ë³´í•˜ëŠ” ë° ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.

### 7. Clean Up After Installations

íŒ¨í‚¤ì§€ ì„¤ì¹˜ í›„ì—ëŠ” ì„ì‹œ íŒŒì¼ê³¼ ìºì‹œë¥¼ ì œê±°í•˜ì—¬ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `apt-get`ì„ ì‚¬ìš©í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìºì‹œë¥¼ ì²­ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
RUN apt-get update && \
    apt-get install -y git && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*
```

### 8. Single Responsibility Principle

ê° Docker ì´ë¯¸ì§€ëŠ” ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤. ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë¥¼ í•˜ë‚˜ì˜ ì´ë¯¸ì§€ì— í¬í•¨ì‹œí‚¤ê¸°ë³´ë‹¤ëŠ” ê° ì„œë¹„ìŠ¤ë§ˆë‹¤ ë³„ë„ì˜ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³ , ì´ë¥¼ Docker Composeë‚˜ Kubernetesë¡œ ì¡°í•©í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

### 9. Optimize Dockerfile Instructions

íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì‹œ íŠ¹ì • ë²„ì „ì„ ì‚¬ìš©í•˜ê³ , ì¢…ì†ì„±ì„ ìµœì†Œí™”í•˜ë©°, ë¶ˆí•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œ í›„ì—ëŠ” ì œê±°í•˜ì—¬ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

### 10. Inspect Image Layers

`docker history` ë° `docker inspect`ì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ë ˆì´ì–´ë¥¼ ë¶„ì„í•˜ê³  ìµœì í™” ê¸°íšŒë¥¼ ì‹ë³„í•©ë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ íŒŒì¼ê³¼ ëª…ë ¹ì„ Dockerfileì—ì„œ ì œê±°í•˜ì—¬ ë ˆì´ì–´ í¬ê¸°ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 11. Docker Image Pruning

ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” Docker ì´ë¯¸ì§€, ì»¨í…Œì´ë„ˆ, ë³¼ë¥¨ ë° ë„¤íŠ¸ì›Œí¬ë¥¼ ì •ê¸°ì ìœ¼ë¡œ ì •ë¦¬í•˜ì—¬ ë””ìŠ¤í¬ ê³µê°„ì„ íšŒìˆ˜í•˜ê³  ì„±ëŠ¥ì„ ê°œì„ í•©ë‹ˆë‹¤. `docker system prune` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

### 12. Implement Caching

Dockerì˜ ë¹Œë“œ ìºì‹œë¥¼ í™œìš©í•˜ì—¬ Dockerfileì„ êµ¬ì„±í•©ë‹ˆë‹¤. ìì£¼ ë³€ê²½ë˜ëŠ” ëª…ë ¹ì–´ëŠ” Dockerfileì˜ ë ë¶€ë¶„ì— ë°°ì¹˜í•˜ì—¬ ìºì‹œ ë¬´íš¨í™”ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤.

### 13. Compress Artifacts

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìƒì„±í•˜ëŠ” ë¹Œë“œ ì•„í‹°íŒ©íŠ¸ë¥¼ ì••ì¶•í•˜ì—¬ Docker ì´ë¯¸ì§€ì— ë³µì‚¬í•˜ê¸° ì „ì— í¬ê¸°ë¥¼ ì¤„ì…ë‹ˆë‹¤. ì´ëŠ” ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ê³  ë¹Œë“œ ì†ë„ë¥¼ ê°œì„ í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

### 14. Use Smaller Alternatives

ê°€ëŠ¥í•œ ê²½ìš° ë„êµ¬ì™€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë” ì‘ì€ ëŒ€ì•ˆì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, BusyBoxë‚˜ Microcontainersë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 15. Use Docker Squash

Docker Squashë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ì˜ í¬ê¸°ë¥¼ ì¤„ì¼ ìˆ˜ ìˆì§€ë§Œ, ë¹Œë“œ ì‹œê°„ì„ ì¦ê°€ì‹œí‚¤ê³  ìºì‹œ ê°€ëŠ¥ì„±ì„ ì¤„ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

## ConclusionğŸ‰

ì´ëŸ¬í•œ ì „ëµì„ í†µí•´ Docker ì´ë¯¸ì§€ë¥¼ ìµœì í™”í•˜ê³  í¬ê¸°ë¥¼ ì¤„ì´ë©´ ë°°í¬ ì†ë„ê°€ ê°œì„ ë˜ê³  ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ì´ ê°ì†Œí•˜ë©° ë³´ì•ˆì´ ê°•í™”ë©ë‹ˆë‹¤.  
Docker ì´ë¯¸ì§€ëŠ” ë‹¨ìˆœí•œ ë„êµ¬ê°€ ì•„ë‹Œ, íš¨ìœ¨ì ì¸ ê°œë°œ ë° ë°°í¬ë¥¼ ìœ„í•œ ì¤‘ìš”í•œ ìš”ì†Œë¡œì„œ ì¢‹ì€ ë°©ë²•ì´ ìˆë‹¤ë©´ ì§€ì†í•´ì„œ í•™ìŠµí•  ì—ì •ì…ë‹ˆë‹¤.


> ì°¸ê³ ìë£Œ [url1](https://overcast.blog/docker-image-optimization-tips-tricks-6a17f687162b), [url2](https://faun.pub/reduce-the-size-of-the-docker-image-e6895b653419)
